

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Earthquake Risk Assessment &#8212; Global Infrastructure Risk Assesments</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'hazard/earthquake';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Wildfire exposure assessment" href="wildfire.html" />
    <link rel="prev" title="Flood risk assessment" href="flood.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/IVM_logo_kort.jpg" class="logo__image only-light" alt="Global Infrastructure Risk Assesments - Home"/>
    <script>document.write(`<img src="../_static/IVM_logo_kort.jpg" class="logo__image only-dark" alt="Global Infrastructure Risk Assesments - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">The Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro/ci_explained.html">Critical Infrastructure Explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/hazard.html">Hazard &amp; Hazard Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/exposure.html">Exposure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/vulnerability.html">Vulnerability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/damage_risk.html">Damage &amp; Risk</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">How it works</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../howto/damagescanner.html">Introducing <code class="docutils literal notranslate"><span class="pre">DamageScanner()</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/run_locally.html">Run Locally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/using_osm.html">Using OpenStreetMap (OSM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/using_tailor_data.html">Using Local Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/maximum_damages.html">Maximum Damages Explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/data_preparation.html">Specific Data Preparations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howto/example_overview.html">Overview of Examples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">By Infrastructure System</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ci/transport.html">Transportation Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci/power.html">Power Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci/telecom.html">Telecommunication Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci/healthcare.html">Healthcare Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ci/education.html">Education Infrastructure</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">By Natural Hazard</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="flood.html">Flood risk assessment</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Earthquake Risk Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="wildfire.html">Wildfire exposure assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="heatwaves.html">Extreme Heat</a></li>
<li class="toctree-l1"><a class="reference internal" href="tropical_cyclone.html">Tropical Cyclone Risk Assessment</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Specific Use Cases</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../use_cases/all_ci_exposure.html">Country-level exposure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/all_ci_vulnerability.html">Country-level vulnerability assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/all_ci_risk.html">Country-level risk assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/multi-country.html">Multi-country Analysis for Transportation Infrastructure</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/VU-IVM/GlobalInfraRisk/blob/main/hazard/earthquake.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/VU-IVM/GlobalInfraRisk" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/VU-IVM/GlobalInfraRisk/issues/new?title=Issue%20on%20page%20%2Fhazard/earthquake.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/hazard/earthquake.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Earthquake Risk Assessment</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-necessary-packages">1. Loading the Necessary Packages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-the-country-of-interest">Specify the country of interest</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">2. Loading the Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#infrastructure-data">Infrastructure Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hazard-data">Hazard Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-damages">Maximum damages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#vulnerability-data">Vulnerability data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ancilliary-data-for-processing">Ancilliary data for processing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-data">3. Preparing the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-an-exposure-assessment">4. Performing an Exposure Assessment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-a-vulnerability-assessment">5. Performing a Vulnerability Assessment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-the-damage-assessment">6. Performing the Damage Assessment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-the-results">7. Save the Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-results">8. Visualizing the Results</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="earthquake-risk-assessment">
<h1>Earthquake Risk Assessment<a class="headerlink" href="#earthquake-risk-assessment" title="Permalink to this heading">#</a></h1>
<p>In this notebook, we will perform an <strong>earthquake damage and risk assessment</strong> for transportation infrastructure, specifically focusing on roads. The assessment is based on combining hazard data (e.g., PGA levels) with vulnerability curves to estimate the potential damage to infrastructure.</p>
<p>We will follow the steps outlined below to conduct the assessment:</p>
<ol class="arabic simple">
<li><p><strong>Loading the necessary packages:</strong><br />
We will import the Python libraries required for data handling, analysis, and visualization.</p></li>
<li><p><strong>Loading the data:</strong><br />
The infrastructure data (e.g., roads) and hazard data (e.g., PGA levels) will be loaded into the notebook.</p></li>
<li><p><strong>Preparing the data:</strong><br />
The infrastructure and hazard data will be processed and data gaps can be filled, if required.</p></li>
<li><p><strong>Performing the damage assessment:</strong><br />
We will apply vulnerability curves to estimate the potential damage based on the intensity of the hazard.</p></li>
<li><p><strong>Visualizing the results:</strong><br />
Finally, we will visualize the estimated damage using graphs and maps to illustrate the impact on transportation infrastructure.</p></li>
</ol>
<section id="loading-the-necessary-packages">
<h2>1. Loading the Necessary Packages<a class="headerlink" href="#loading-the-necessary-packages" title="Permalink to this heading">#</a></h2>
<p>To perform the assessment, we are going to make use of several <a class="reference external" href="https://docs.python.org/3/tutorial/modules.html#packages">python packages</a>.</p>
<p>In case you run this in Google Colab, you will have to install the packages below <strong>(remove the hashtag in front of them)</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install damagescanner==0.9b13</span>
<span class="c1">#!pip install contextily</span>
<span class="c1">#!pip install exactextract</span>
<span class="c1">#!pip install lonboard</span>
</pre></div>
</div>
</div>
</div>
<p>In this step, we will import all the required Python libraries for data manipulation, spatial analysis, and visualization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shapely</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">contextily</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cx</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">damagescanner.download</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">download</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">damagescanner.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">DamageScanner</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">damagescanner.osm</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_osm_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">damagescanner.base_values</span><span class="w"> </span><span class="kn">import</span> <span class="n">DICT_CIS_VULNERABILITY_FLOOD</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statistics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mode</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">lonboard</span><span class="w"> </span><span class="kn">import</span> <span class="n">viz</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span> <span class="c1"># exactextract gives a warning that is invalid</span>
</pre></div>
</div>
</div>
</div>
<section id="specify-the-country-of-interest">
<h3>Specify the country of interest<a class="headerlink" href="#specify-the-country-of-interest" title="Permalink to this heading">#</a></h3>
<p>Before we continue, we should specify the country for which we want to assess the damage. We use the ISO3 code for the country to download the OpenStreetMap data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_full_name</span> <span class="o">=</span> <span class="s1">&#39;Tajikistan&#39;</span>
<span class="n">country_iso3</span> <span class="o">=</span> <span class="s1">&#39;TJK&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="loading-the-data">
<h2>2. Loading the Data<a class="headerlink" href="#loading-the-data" title="Permalink to this heading">#</a></h2>
<p>In this step, we will load four key datasets:</p>
<ol class="arabic simple">
<li><p><strong>Infrastructure data:</strong><br />
This dataset contains information on the location and type of transportation infrastructure (e.g., roads). Each asset may have attributes such as type, length, and replacement cost.</p></li>
<li><p><strong>Hazard data:</strong><br />
This dataset includes information on the hazard affecting the infrastructure (e.g., flood depth at various locations).</p></li>
<li><p><strong>Vulnerability curves:</strong><br />
Vulnerability curves define how the infrastructure’s damage increases with the intensity of the hazard. For example, flood depth-damage curves specify how much damage occurs for different flood depths.</p></li>
<li><p><strong>Maximum damage values:</strong><br />
This dataset contains the maximum possible damage (in monetary terms) that can be incurred by individual infrastructure assets. This is crucial for calculating total damage based on the vulnerability curves.</p></li>
</ol>
<section id="infrastructure-data">
<h3>Infrastructure Data<a class="headerlink" href="#infrastructure-data" title="Permalink to this heading">#</a></h3>
<p>We will perform this example analysis for Tajikistan. To start the analysis, we first download the OpenStreetMap data from GeoFabrik. In case of locally available data, one can load the shapefiles through <strong>gpd.read_file()</strong>, as we show in the second cell within this section.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infrastructure_path</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">get_country_geofabrik</span><span class="p">(</span><span class="n">country_iso3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we load the data and read only the road data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">read_osm_data</span><span class="p">(</span><span class="n">infrastructure_path</span><span class="p">,</span><span class="n">asset_type</span><span class="o">=</span><span class="s1">&#39;roads&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: total: 6.86 s
Wall time: 8.41 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub_types</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">object_type</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub_types</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;primary&#39;, &#39;trunk&#39;, &#39;track&#39;, &#39;tertiary&#39;, &#39;secondary&#39;,
       &#39;residential&#39;, &#39;secondary_link&#39;, &#39;trunk_link&#39;, &#39;unclassified&#39;,
       &#39;tertiary_link&#39;, &#39;primary_link&#39;, &#39;road&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
</section>
<section id="hazard-data">
<h3>Hazard Data<a class="headerlink" href="#hazard-data" title="Permalink to this heading">#</a></h3>
<p>For this example, we make use of the flood data provided by <a class="reference external" href="https://giri.unepgrid.ch/map?list=explore">CDRI</a>.</p>
<p>We use a 1/475 earthquake hazard map to showcase the approach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_map</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s2">&quot;https://hazards-data.unepgrid.ch/PGA_475y.tif&quot;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;rasterio&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="maximum-damages">
<h3>Maximum damages<a class="headerlink" href="#maximum-damages" title="Permalink to this heading">#</a></h3>
<p>One of the most difficult parts of the assessment is to define the maximum reconstruction cost of particular assets. Here we provide a baseline set of values, but these should be updated through national consultations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maxdam_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trunk&#39;</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span> 
               <span class="s1">&#39;motorway&#39;</span> <span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
                <span class="s1">&#39;primary&#39;</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span> 
                <span class="s1">&#39;secondary&#39;</span><span class="p">:</span><span class="mi">1300</span><span class="p">,</span> 
                <span class="s1">&#39;tertiary&#39;</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span> 
                <span class="s1">&#39;trunk_link&#39;</span><span class="p">:</span> <span class="mi">1300</span><span class="p">,</span>
                <span class="s1">&#39;motorway_link&#39;</span> <span class="p">:</span> <span class="mi">1300</span><span class="p">,</span>
                <span class="s1">&#39;primary_link&#39;</span> <span class="p">:</span> <span class="mi">1300</span><span class="p">,</span>
               <span class="s1">&#39;secondary_link&#39;</span> <span class="p">:</span> <span class="mi">700</span><span class="p">,</span>
               <span class="s1">&#39;tertiary_link&#39;</span> <span class="p">:</span> <span class="mi">700</span><span class="p">,</span>
               <span class="s1">&#39;track&#39;</span> <span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
               <span class="s1">&#39;unclassified&#39;</span> <span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
               <span class="s1">&#39;road&#39;</span> <span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
               <span class="s1">&#39;residential&#39;</span> <span class="p">:</span> <span class="mi">300</span>
              <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>To be used in our damage assessment, we convert this to a Pandas DataFrame</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maxdam</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">maxdam_dict</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">maxdam</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;object_type&#39;</span><span class="p">,</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="vulnerability-data">
<h3>Vulnerability data<a class="headerlink" href="#vulnerability-data" title="Permalink to this heading">#</a></h3>
<p>Similarly to the maximum damages, specifying the vulnerability curves is complex. We generally have limited information about the quality of the assets, its level of deteriation and other asset-level characteristics. The study by Nirandjan et al. (2024) provides us with a baseline set of fragility and vulnerability curves that one can use. In the following cell, we load that data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vulnerability_path</span> <span class="o">=</span> <span class="s2">&quot;https://zenodo.org/records/13889558/files/Table_D2_Hazard_Fragility_and_Vulnerability_Curves_V1.1.0.xlsx?download=1&quot;</span>
<span class="n">vul_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">vulnerability_path</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;E_Vuln_PGA &#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And let’s have a look at all the available options</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">option_context</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
  <span class="n">display</span><span class="p">(</span><span class="n">vul_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ID number</th>
      <td>Infrastructure type</td>
      <td>Infrastructure type details</td>
    </tr>
    <tr>
      <th>E1.1</th>
      <td>Power plant</td>
      <td>Small generation facilities with anchored comp...</td>
    </tr>
    <tr>
      <th>E1.1a</th>
      <td>Power plant</td>
      <td>Small generation facilities with anchored comp...</td>
    </tr>
    <tr>
      <th>E1.1b</th>
      <td>Power plant</td>
      <td>Small generation facilities with anchored comp...</td>
    </tr>
    <tr>
      <th>E1.2</th>
      <td>Power plant</td>
      <td>Small generation facilities with unanchored co...</td>
    </tr>
    <tr>
      <th>E1.2a</th>
      <td>Power plant</td>
      <td>Small generation facilities with unanchored co...</td>
    </tr>
    <tr>
      <th>E1.2b</th>
      <td>Power plant</td>
      <td>Small generation facilities with unanchored co...</td>
    </tr>
    <tr>
      <th>E1.3</th>
      <td>Power plant</td>
      <td>Medium/large power with anchored components</td>
    </tr>
    <tr>
      <th>E1.3a</th>
      <td>Power plant</td>
      <td>Medium/large power with anchored components</td>
    </tr>
    <tr>
      <th>E1.3b</th>
      <td>Power plant</td>
      <td>Medium/large power with anchored components</td>
    </tr>
    <tr>
      <th>E1.4</th>
      <td>Power plant</td>
      <td>Medium/large power with unanchored components</td>
    </tr>
    <tr>
      <th>E1.4a</th>
      <td>Power plant</td>
      <td>Medium/large power with unanchored components</td>
    </tr>
    <tr>
      <th>E1.4b</th>
      <td>Power plant</td>
      <td>Medium/large power with unanchored components</td>
    </tr>
    <tr>
      <th>E1.15</th>
      <td>Hydropower plants</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>E2.1</th>
      <td>substation</td>
      <td>Low Voltage Substation anchored</td>
    </tr>
    <tr>
      <th>E2.1a</th>
      <td>substation</td>
      <td>Low Voltage Substation anchored</td>
    </tr>
    <tr>
      <th>E2.1b</th>
      <td>substation</td>
      <td>Low Voltage Substation anchored</td>
    </tr>
    <tr>
      <th>E2.2</th>
      <td>substation</td>
      <td>Low Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E2.2a</th>
      <td>substation</td>
      <td>Low Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E2.2b</th>
      <td>substation</td>
      <td>Low Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E2.3</th>
      <td>substation</td>
      <td>Medium Voltage Substation anchored</td>
    </tr>
    <tr>
      <th>E2.3a</th>
      <td>substation</td>
      <td>Medium Voltage Substation anchored</td>
    </tr>
    <tr>
      <th>E2.3b</th>
      <td>substation</td>
      <td>Medium Voltage Substation anchored</td>
    </tr>
    <tr>
      <th>E2.4</th>
      <td>substation</td>
      <td>Medium Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E2.4a</th>
      <td>substation</td>
      <td>Medium Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E2.4b</th>
      <td>substation</td>
      <td>Medium Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E2.5</th>
      <td>substation</td>
      <td>High Voltage Substation anchored</td>
    </tr>
    <tr>
      <th>E2.5a</th>
      <td>substation</td>
      <td>High Voltage Substation anchored</td>
    </tr>
    <tr>
      <th>E2.5b</th>
      <td>substation</td>
      <td>High Voltage Substation anchored</td>
    </tr>
    <tr>
      <th>E2.6</th>
      <td>substation</td>
      <td>High Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E2.6a</th>
      <td>substation</td>
      <td>High Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E2.6b</th>
      <td>substation</td>
      <td>High Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E2.9a</th>
      <td>Substation</td>
      <td>Low Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E2.9b</th>
      <td>Substation</td>
      <td>Low Voltage Substation unanchored</td>
    </tr>
    <tr>
      <th>E4.1</th>
      <td>Power pole</td>
      <td>Anchored/seismic components</td>
    </tr>
    <tr>
      <th>E4.1a</th>
      <td>Power pole</td>
      <td>Anchored/seismic components</td>
    </tr>
    <tr>
      <th>E4.1b</th>
      <td>Power pole</td>
      <td>Anchored/seismic components</td>
    </tr>
    <tr>
      <th>E4.2</th>
      <td>Power pole</td>
      <td>Unanchored/standard components</td>
    </tr>
    <tr>
      <th>E4.2a</th>
      <td>Power pole</td>
      <td>Unanchored/standard components</td>
    </tr>
    <tr>
      <th>E4.2b</th>
      <td>Power pole</td>
      <td>Unanchored/standard components</td>
    </tr>
    <tr>
      <th>E5.1</th>
      <td>Cable</td>
      <td>Distribution circuit with seismic/anchored</td>
    </tr>
    <tr>
      <th>E5.1a</th>
      <td>Cable</td>
      <td>Distribution circuit with seismic/anchored</td>
    </tr>
    <tr>
      <th>E5.1b</th>
      <td>Cable</td>
      <td>Distribution circuit with seismic/anchored</td>
    </tr>
    <tr>
      <th>E5.2</th>
      <td>Cable</td>
      <td>Distribution circuit with unanchored/standard ...</td>
    </tr>
    <tr>
      <th>E5.2a</th>
      <td>Cable</td>
      <td>Distribution circuit with unanchored/standard ...</td>
    </tr>
    <tr>
      <th>E5.2b</th>
      <td>Cable</td>
      <td>Distribution circuit with unanchored/standard ...</td>
    </tr>
    <tr>
      <th>E6.1</th>
      <td>Power lines</td>
      <td>Distribution circuit with seismic/anchored</td>
    </tr>
    <tr>
      <th>E6.1a</th>
      <td>Power lines</td>
      <td>Distribution circuit with seismic/anchored</td>
    </tr>
    <tr>
      <th>E6.1b</th>
      <td>Power lines</td>
      <td>Distribution circuit with seismic/anchored</td>
    </tr>
    <tr>
      <th>E6.2</th>
      <td>Power lines</td>
      <td>Distribution circuit with unanchored/standard ...</td>
    </tr>
    <tr>
      <th>E6.2a</th>
      <td>Power lines</td>
      <td>Distribution circuit with unanchored/standard ...</td>
    </tr>
    <tr>
      <th>E6.2b</th>
      <td>Power lines</td>
      <td>Distribution circuit with unanchored/standard ...</td>
    </tr>
    <tr>
      <th>E8.1</th>
      <td>Railway</td>
      <td>Fuel facility: Anchored components with backup...</td>
    </tr>
    <tr>
      <th>E8.1a</th>
      <td>Railway</td>
      <td>Fuel facility: Anchored components with backup...</td>
    </tr>
    <tr>
      <th>E8.1b</th>
      <td>Railway</td>
      <td>Fuel facility: Anchored components with backup...</td>
    </tr>
    <tr>
      <th>E8.2</th>
      <td>Railway</td>
      <td>Fuel facility: Anchored components w/o backup ...</td>
    </tr>
    <tr>
      <th>E8.2a</th>
      <td>Railway</td>
      <td>Fuel facility: Anchored components w/o backup ...</td>
    </tr>
    <tr>
      <th>E8.2b</th>
      <td>Railway</td>
      <td>Fuel facility: Anchored components w/o backup ...</td>
    </tr>
    <tr>
      <th>E8.3</th>
      <td>Railway</td>
      <td>Fuel facility: Unanchored components with back...</td>
    </tr>
    <tr>
      <th>E8.3a</th>
      <td>Railway</td>
      <td>Fuel facility: Unanchored components with back...</td>
    </tr>
    <tr>
      <th>E8.3b</th>
      <td>Railway</td>
      <td>Fuel facility: Unanchored components with back...</td>
    </tr>
    <tr>
      <th>E8.4</th>
      <td>Railway</td>
      <td>Fuel facility: Unanchored components w/o backu...</td>
    </tr>
    <tr>
      <th>E8.4a</th>
      <td>Railway</td>
      <td>Fuel facility: Unanchored components w/o backu...</td>
    </tr>
    <tr>
      <th>E8.4b</th>
      <td>Railway</td>
      <td>Fuel facility: Unanchored components w/o backu...</td>
    </tr>
    <tr>
      <th>E8.5</th>
      <td>Railway</td>
      <td>Dispatch facility: Anchored components with ba...</td>
    </tr>
    <tr>
      <th>E8.5a</th>
      <td>Railway</td>
      <td>Dispatch facility: Anchored components with ba...</td>
    </tr>
    <tr>
      <th>E8.5b</th>
      <td>Railway</td>
      <td>Dispatch facility: Anchored components with ba...</td>
    </tr>
    <tr>
      <th>E8.6</th>
      <td>Railway</td>
      <td>Dispatch facility: Anchored components w/o bac...</td>
    </tr>
    <tr>
      <th>E8.6a</th>
      <td>Railway</td>
      <td>Dispatch facility: Anchored components w/o bac...</td>
    </tr>
    <tr>
      <th>E8.6b</th>
      <td>Railway</td>
      <td>Dispatch facility: Anchored components w/o bac...</td>
    </tr>
    <tr>
      <th>E8.7</th>
      <td>Railway</td>
      <td>Dispatch facility: Unanchored components with ...</td>
    </tr>
    <tr>
      <th>E8.7a</th>
      <td>Railway</td>
      <td>Dispatch facility: Unanchored components with ...</td>
    </tr>
    <tr>
      <th>E8.7b</th>
      <td>Railway</td>
      <td>Dispatch facility: Unanchored components with ...</td>
    </tr>
    <tr>
      <th>E8.8</th>
      <td>Railway</td>
      <td>Dispatch facility: Unanchored components w/o b...</td>
    </tr>
    <tr>
      <th>E8.8a</th>
      <td>Railway</td>
      <td>Dispatch facility: Unanchored components w/o b...</td>
    </tr>
    <tr>
      <th>E8.8b</th>
      <td>Railway</td>
      <td>Dispatch facility: Unanchored components w/o b...</td>
    </tr>
    <tr>
      <th>E8.9</th>
      <td>Railway</td>
      <td>Light rail DC Power substation: anchored</td>
    </tr>
    <tr>
      <th>E8.9a</th>
      <td>Railway</td>
      <td>Light rail DC Power substation: anchored</td>
    </tr>
    <tr>
      <th>E8.9b</th>
      <td>Railway</td>
      <td>Light rail DC Power substation: anchored</td>
    </tr>
    <tr>
      <th>E8.10</th>
      <td>Railway</td>
      <td>Light rail DC Power substation: unanchored</td>
    </tr>
    <tr>
      <th>E8.10a</th>
      <td>Railway</td>
      <td>Light rail DC Power substation: unanchored</td>
    </tr>
    <tr>
      <th>E8.10b</th>
      <td>Railway</td>
      <td>Light rail DC Power substation: unanchored</td>
    </tr>
    <tr>
      <th>E9.1</th>
      <td>Airports</td>
      <td>Anchored components with backup power</td>
    </tr>
    <tr>
      <th>E9.1a</th>
      <td>Airports</td>
      <td>Anchored components with backup power</td>
    </tr>
    <tr>
      <th>E9.1b</th>
      <td>Airports</td>
      <td>Anchored components with backup power</td>
    </tr>
    <tr>
      <th>E9.2</th>
      <td>Airports</td>
      <td>Anchored components w/o backup power</td>
    </tr>
    <tr>
      <th>E9.2a</th>
      <td>Airports</td>
      <td>Anchored components w/o backup power</td>
    </tr>
    <tr>
      <th>E9.2b</th>
      <td>Airports</td>
      <td>Anchored components w/o backup power</td>
    </tr>
    <tr>
      <th>E9.3</th>
      <td>Airports</td>
      <td>Unanchored components with backup power</td>
    </tr>
    <tr>
      <th>E9.3a</th>
      <td>Airports</td>
      <td>Unanchored components with backup power</td>
    </tr>
    <tr>
      <th>E9.3b</th>
      <td>Airports</td>
      <td>Unanchored components with backup power</td>
    </tr>
    <tr>
      <th>E9.4</th>
      <td>Airports</td>
      <td>Unanchored components w/o backup power</td>
    </tr>
    <tr>
      <th>E9.4a</th>
      <td>Airports</td>
      <td>Unanchored components w/o backup power</td>
    </tr>
    <tr>
      <th>E9.4b</th>
      <td>Airports</td>
      <td>Unanchored components w/o backup power</td>
    </tr>
    <tr>
      <th>E12.1</th>
      <td>Others</td>
      <td>Central offices and broadcasting stations with...</td>
    </tr>
    <tr>
      <th>E12.1a</th>
      <td>Others</td>
      <td>Central offices and broadcasting stations with...</td>
    </tr>
    <tr>
      <th>E12.1b</th>
      <td>Others</td>
      <td>Central offices and broadcasting stations with...</td>
    </tr>
    <tr>
      <th>E12.2</th>
      <td>Others</td>
      <td>Central offices and broadcasting stations with...</td>
    </tr>
    <tr>
      <th>E12.2a</th>
      <td>Others</td>
      <td>Central offices and broadcasting stations with...</td>
    </tr>
    <tr>
      <th>E12.2b</th>
      <td>Others</td>
      <td>Central offices and broadcasting stations with...</td>
    </tr>
    <tr>
      <th>E13.1</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground concrete tank, a...</td>
    </tr>
    <tr>
      <th>E13.1a</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground concrete tank, a...</td>
    </tr>
    <tr>
      <th>E13.1b</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground concrete tank, a...</td>
    </tr>
    <tr>
      <th>E13.2</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground concrete tank, u...</td>
    </tr>
    <tr>
      <th>E13.2a</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground concrete tank, u...</td>
    </tr>
    <tr>
      <th>E13.2b</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground concrete tank, u...</td>
    </tr>
    <tr>
      <th>E13.3</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground steel tank, anch...</td>
    </tr>
    <tr>
      <th>E13.3a</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground steel tank, anch...</td>
    </tr>
    <tr>
      <th>E13.3b</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground steel tank, anch...</td>
    </tr>
    <tr>
      <th>E13.4</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground steel tank, unan...</td>
    </tr>
    <tr>
      <th>E13.4a</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground steel tank, unan...</td>
    </tr>
    <tr>
      <th>E13.4b</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground steel tank, unan...</td>
    </tr>
    <tr>
      <th>E13.5</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks Above-ground steel tank</td>
    </tr>
    <tr>
      <th>E13.5a</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks Above-ground steel tank</td>
    </tr>
    <tr>
      <th>E13.5b</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks Above-ground steel tank</td>
    </tr>
    <tr>
      <th>E13.6</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground wood tank</td>
    </tr>
    <tr>
      <th>E13.6a</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground wood tank</td>
    </tr>
    <tr>
      <th>E13.6b</th>
      <td>Reservoir covered</td>
      <td>Water storage tanks On-ground wood tank</td>
    </tr>
    <tr>
      <th>E14.1</th>
      <td>Water treatment plant</td>
      <td>Small, anchored</td>
    </tr>
    <tr>
      <th>E14.1 a</th>
      <td>Water treatment plant</td>
      <td>Small, anchored</td>
    </tr>
    <tr>
      <th>E14.1b</th>
      <td>Water treatment plant</td>
      <td>Small, anchored</td>
    </tr>
    <tr>
      <th>E14.2</th>
      <td>Water treatment plant</td>
      <td>Small, unanchored</td>
    </tr>
    <tr>
      <th>E14.2a</th>
      <td>Water treatment plant</td>
      <td>Small, unanchored</td>
    </tr>
    <tr>
      <th>E14.2b</th>
      <td>Water treatment plant</td>
      <td>Small, unanchored</td>
    </tr>
    <tr>
      <th>E14.3</th>
      <td>Water treatment plant</td>
      <td>Medium, anchored</td>
    </tr>
    <tr>
      <th>E14.3a</th>
      <td>Water treatment plant</td>
      <td>Medium, anchored</td>
    </tr>
    <tr>
      <th>E14.3b</th>
      <td>Water treatment plant</td>
      <td>Medium, anchored</td>
    </tr>
    <tr>
      <th>E14.4</th>
      <td>Water treatment plant</td>
      <td>Medium, unanchored</td>
    </tr>
    <tr>
      <th>E14.4a</th>
      <td>Water treatment plant</td>
      <td>Medium, unanchored</td>
    </tr>
    <tr>
      <th>E14.4b</th>
      <td>Water treatment plant</td>
      <td>Medium, unanchored</td>
    </tr>
    <tr>
      <th>E14.5</th>
      <td>Water treatment plant</td>
      <td>Large, anchored</td>
    </tr>
    <tr>
      <th>E14.5a</th>
      <td>Water treatment plant</td>
      <td>Large, anchored</td>
    </tr>
    <tr>
      <th>E14.5b</th>
      <td>Water treatment plant</td>
      <td>Large, anchored</td>
    </tr>
    <tr>
      <th>E14.6</th>
      <td>Water treatment plant</td>
      <td>Large, unanchored</td>
    </tr>
    <tr>
      <th>E14.6a</th>
      <td>Water treatment plant</td>
      <td>Large, unanchored</td>
    </tr>
    <tr>
      <th>E14.6b</th>
      <td>Water treatment plant</td>
      <td>Large, unanchored</td>
    </tr>
    <tr>
      <th>E15.1</th>
      <td>Water well</td>
      <td>Anchored</td>
    </tr>
    <tr>
      <th>E15.1a</th>
      <td>Water well</td>
      <td>Anchored</td>
    </tr>
    <tr>
      <th>E15.1b</th>
      <td>Water well</td>
      <td>Anchored</td>
    </tr>
    <tr>
      <th>E16.24</th>
      <td>Transmission and distribution pipelines</td>
      <td>PVC, continious joint type continuous (i.e., d...</td>
    </tr>
    <tr>
      <th>E17.1</th>
      <td>Others</td>
      <td>Small pumping plant, anchored</td>
    </tr>
    <tr>
      <th>E17.1a</th>
      <td>Others</td>
      <td>Small pumping plant, anchored</td>
    </tr>
    <tr>
      <th>E17.1b</th>
      <td>Others</td>
      <td>Small pumping plant, anchored</td>
    </tr>
    <tr>
      <th>E17.2</th>
      <td>Others</td>
      <td>Small pumping plant, unanchored</td>
    </tr>
    <tr>
      <th>E17.2a</th>
      <td>Others</td>
      <td>Small pumping plant, unanchored</td>
    </tr>
    <tr>
      <th>E17.2b</th>
      <td>Others</td>
      <td>Small pumping plant, unanchored</td>
    </tr>
    <tr>
      <th>E17.3</th>
      <td>Others</td>
      <td>Medium/large pumping plant, anchored</td>
    </tr>
    <tr>
      <th>E17.3a</th>
      <td>Others</td>
      <td>Medium/large pumping plant, anchored</td>
    </tr>
    <tr>
      <th>E17.3b</th>
      <td>Others</td>
      <td>Medium/large pumping plant, anchored</td>
    </tr>
    <tr>
      <th>E17.4</th>
      <td>Others</td>
      <td>Medium/large pumping plant, unanchored</td>
    </tr>
    <tr>
      <th>E17.4a</th>
      <td>Others</td>
      <td>Medium/large pumping plant, unanchored</td>
    </tr>
    <tr>
      <th>E17.4b</th>
      <td>Others</td>
      <td>Medium/large pumping plant, unanchored</td>
    </tr>
    <tr>
      <th>E18.1</th>
      <td>Wastewater treatment plant</td>
      <td>Small anchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.1a</th>
      <td>Wastewater treatment plant</td>
      <td>Small anchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.1b</th>
      <td>Wastewater treatment plant</td>
      <td>Small anchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.2</th>
      <td>Wastewater treatment plant</td>
      <td>Small unanchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.2a</th>
      <td>Wastewater treatment plant</td>
      <td>Small unanchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.2b</th>
      <td>Wastewater treatment plant</td>
      <td>Small unanchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.3</th>
      <td>Wastewater treatment plant</td>
      <td>Medium anchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.3a</th>
      <td>Wastewater treatment plant</td>
      <td>Medium anchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.3b</th>
      <td>Wastewater treatment plant</td>
      <td>Medium anchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.4</th>
      <td>Wastewater treatment plant</td>
      <td>Medium unanchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.4a</th>
      <td>Wastewater treatment plant</td>
      <td>Medium unanchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.4b</th>
      <td>Wastewater treatment plant</td>
      <td>Medium unanchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.5</th>
      <td>Wastewater treatment plant</td>
      <td>Large anchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.5a</th>
      <td>Wastewater treatment plant</td>
      <td>Large anchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.5b</th>
      <td>Wastewater treatment plant</td>
      <td>Large anchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.6</th>
      <td>Wastewater treatment plant</td>
      <td>Large unanchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.6a</th>
      <td>Wastewater treatment plant</td>
      <td>Large unanchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E18.6b</th>
      <td>Wastewater treatment plant</td>
      <td>Large unanchored wastewater treatment plants</td>
    </tr>
    <tr>
      <th>E20.1</th>
      <td>Others</td>
      <td>small lift - anchored</td>
    </tr>
    <tr>
      <th>E20.1a</th>
      <td>Others</td>
      <td>small lift - anchored</td>
    </tr>
    <tr>
      <th>E20.1b</th>
      <td>Others</td>
      <td>small lift - anchored</td>
    </tr>
    <tr>
      <th>E20.2</th>
      <td>Others</td>
      <td>small lift - unanchored</td>
    </tr>
    <tr>
      <th>E20.2a</th>
      <td>Others</td>
      <td>small lift - unanchored</td>
    </tr>
    <tr>
      <th>E20.2b</th>
      <td>Others</td>
      <td>small lift - unanchored</td>
    </tr>
    <tr>
      <th>E20.3</th>
      <td>Others</td>
      <td>medium/large lift - anchored</td>
    </tr>
    <tr>
      <th>E20.3a</th>
      <td>Others</td>
      <td>medium/large lift - anchored</td>
    </tr>
    <tr>
      <th>E20.3b</th>
      <td>Others</td>
      <td>medium/large lift - anchored</td>
    </tr>
    <tr>
      <th>E20.4</th>
      <td>Others</td>
      <td>medium/large unanchored</td>
    </tr>
    <tr>
      <th>E20.4a</th>
      <td>Others</td>
      <td>medium/large unanchored</td>
    </tr>
    <tr>
      <th>E20.4b</th>
      <td>Others</td>
      <td>medium/large unanchored</td>
    </tr>
    <tr>
      <th>E21.11</th>
      <td>Educational facilities</td>
      <td>Reinforced concrete four-story building</td>
    </tr>
    <tr>
      <th>E21.11a</th>
      <td>Educational facilities</td>
      <td>Reinforced concrete four-story building</td>
    </tr>
    <tr>
      <th>E21.11b</th>
      <td>Educational facilities</td>
      <td>Reinforced concrete four-story building</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And select a curve to use for each different subtype we are analysing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub_types</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;primary&#39;, &#39;trunk&#39;, &#39;track&#39;, &#39;tertiary&#39;, &#39;secondary&#39;,
       &#39;residential&#39;, &#39;secondary_link&#39;, &#39;trunk_link&#39;, &#39;unclassified&#39;,
       &#39;tertiary_link&#39;, &#39;primary_link&#39;, &#39;road&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">selected_curves</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sub_types</span><span class="p">,[</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">,</span><span class="s1">&#39;E8.9&#39;</span><span class="p">]))</span> <span class="c1">#NOTE: these are incorrect curves for Roads. This is an example.</span>
</pre></div>
</div>
</div>
</div>
<p>The next step is to extract the curves from the database, and prepare them for proper usage into our analysis.</p>
<p>We start by selecting the curve IDs from the larger pandas DataFrame <strong>vul_df</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">damage_curves</span> <span class="o">=</span> <span class="n">vul_df</span><span class="p">[[</span><span class="s1">&#39;ID number&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">selected_curves</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
<span class="n">damage_curves</span> <span class="o">=</span> <span class="n">damage_curves</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">125</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
</div>
<p>Then for convenience, we rename the index name to the hazard intensity we are considering.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">damage_curves</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;ID number&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">damage_curves</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">damage_curves</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;PGA&#39;</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<p>And make sure that our damage values are in floating numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">damage_curves</span> <span class="o">=</span> <span class="n">damage_curves</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And ensure that the columns of the curves link back to the different asset types we are considering:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">damage_curves</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">sub_types</span>
</pre></div>
</div>
</div>
</div>
<p>There could be some <strong>NaN</strong> values at the tail of some of the curves. To make sure the code works, we fill up the <strong>NaN</strong> values with the last value of each of the curves.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">damage_curves</span> <span class="o">=</span> <span class="n">damage_curves</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, make sure we set the index of the damage curves (the PGA levels) in the same metric as the hazard data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">damage_curves</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">damage_curves</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="mi">980</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ancilliary-data-for-processing">
<h3>Ancilliary data for processing<a class="headerlink" href="#ancilliary-data-for-processing" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;https://github.com/nvkelso/natural-earth-vector/raw/master/10m_cultural/ne_10m_admin_0_countries.shp&quot;</span><span class="p">)</span>
<span class="n">world_plot</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">admin1</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;https://github.com/nvkelso/natural-earth-vector/raw/master/10m_cultural/ne_10m_admin_1_states_provinces.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="preparing-the-data">
<h2>3. Preparing the Data<a class="headerlink" href="#preparing-the-data" title="Permalink to this heading">#</a></h2>
<p>Clip the hazard data to the country of interest.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">country_bounds</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">world</span><span class="o">.</span><span class="n">ADM0_ISO</span> <span class="o">==</span> <span class="n">country_iso3</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span>
<span class="n">country_geom</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">world</span><span class="o">.</span><span class="n">ADM0_ISO</span> <span class="o">==</span> <span class="n">country_iso3</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_country</span> <span class="o">=</span> <span class="n">hazard_map</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip_box</span><span class="p">(</span><span class="n">minx</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">minx</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">miny</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">miny</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">maxx</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">maxx</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">maxy</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">maxy</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="performing-an-exposure-assessment">
<h2>4. Performing an Exposure Assessment<a class="headerlink" href="#performing-an-exposure-assessment" title="Permalink to this heading">#</a></h2>
<p>We will use the DamageScanner approach. This is a fully optimised damage calculation method, that can capture a wide range of inputs to perform a damage assessment. It also allows to only assess the potential exposure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exposure_results</span> <span class="o">=</span> <span class="n">DamageScanner</span><span class="p">(</span><span class="n">hazard_country</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">damage_curves</span><span class="p">,</span> <span class="n">maxdam</span><span class="p">)</span><span class="o">.</span><span class="n">exposure</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overlay raster with vector: 100%|████████████████████████████████████████████████████| 144/144 [04:39&lt;00:00,  1.94s/it]
convert coverage to meters: 100%|██████████████████████████████████████████████| 84838/84838 [00:20&lt;00:00, 4058.84it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="performing-a-vulnerability-assessment">
<h2>5. Performing a Vulnerability Assessment<a class="headerlink" href="#performing-a-vulnerability-assessment" title="Permalink to this heading">#</a></h2>
<p>In some cases, the cost information is unavailable, or one wants to explore only the exposure and vulnerability. To do so, we simply run the DamageScanner, by setting the maximum costs to 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vulnerability_maxdam</span> <span class="o">=</span> <span class="n">maxdam</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">vulnerability_maxdam</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxdam</span><span class="p">[</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">maxdam</span><span class="p">[</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">vulnerability_results</span> <span class="o">=</span> <span class="n">DamageScanner</span><span class="p">(</span><span class="n">hazard_country</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">damage_curves</span><span class="p">,</span> <span class="n">vulnerability_maxdam</span><span class="p">)</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overlay raster with vector: 100%|████████████████████████████████████████████████████| 144/144 [04:27&lt;00:00,  1.86s/it]
convert coverage to meters: 100%|██████████████████████████████████████████████| 84838/84838 [00:24&lt;00:00, 3403.69it/s]
Calculating damage: 100%|█████████████████████████████████████████████████████| 84838/84838 [00:05&lt;00:00, 14324.73it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: total: 4min 7s
Wall time: 5min 5s
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Important for the earthquake assessment, is the fact that liquefaction can be an important driver of the damages, especially for road and railways. As such, we also overlay our results with a <a class="reference external" href="https://zenodo.org/records/2583746">global liquefaction map</a>, to be able to correct the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">liqeufaction_map</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s2">&quot;https://zenodo.org/records/2583746/files/liquefaction_v1_deg.tif&quot;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;rasterio&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">liqeufaction_country</span> <span class="o">=</span> <span class="n">liqeufaction_map</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip_box</span><span class="p">(</span><span class="n">minx</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">minx</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">miny</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">miny</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">maxx</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">maxx</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">maxy</span><span class="o">=</span><span class="n">country_bounds</span><span class="o">.</span><span class="n">maxy</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">liquefaction_results</span> <span class="o">=</span> <span class="n">DamageScanner</span><span class="p">(</span><span class="n">liqeufaction_country</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">damage_curves</span><span class="p">,</span> <span class="n">maxdam</span><span class="p">)</span><span class="o">.</span><span class="n">exposure</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overlay raster with vector: 100%|████████████████████████████████████████████████████| 144/144 [05:06&lt;00:00,  2.13s/it]
convert coverage to meters: 100%|██████████████████████████████████████████████| 84838/84838 [00:17&lt;00:00, 4793.60it/s]
</pre></div>
</div>
</div>
</div>
<p>Based on the Supplementary Table S6 as provided by <a class="reference external" href="https://www.nature.com/articles/s41467-019-10442-3">Koks et al (2019)</a>, we identify which combinations of liquefaction and earthquake intensity should result in damages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">damage_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>To make things efficient, below we have written a small function to identify those assets that may or may not have damage. If they fall within a damage category, they receive a ‘1’, if they do not fall within a damage category, they receive a ‘0’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_damage_bool</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span><span class="n">liquefaction_results</span><span class="p">,</span><span class="n">damage_dict</span><span class="p">):</span>

    <span class="n">liq_value</span> <span class="o">=</span> <span class="n">mode</span><span class="p">(</span><span class="n">liquefaction_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">feature</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">liq_value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="n">eq_value</span> <span class="o">=</span> <span class="n">mode</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.092</span><span class="o">*</span><span class="mi">980</span><span class="p">,</span> <span class="mf">0.18</span><span class="o">*</span><span class="mi">980</span><span class="p">,</span> <span class="mf">0.34</span><span class="o">*</span><span class="mi">980</span><span class="p">,</span> <span class="mf">0.65</span><span class="o">*</span><span class="mi">980</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)]))</span>

    <span class="k">return</span> <span class="n">damage_dict</span><span class="p">[(</span><span class="n">eq_value</span><span class="p">,</span><span class="n">liq_value</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tqdm</span><span class="o">.</span><span class="n">pandas</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s1">&#39;liquefaction correction boolean&#39;</span><span class="p">)</span>
<span class="n">vulnerability_results</span><span class="p">[</span><span class="s1">&#39;liquefaction_corr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vulnerability_results</span><span class="o">.</span><span class="n">progress_apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">feature</span><span class="p">:</span> <span class="n">get_damage_bool</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span><span class="n">liquefaction_results</span><span class="p">,</span><span class="n">damage_dict</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">vulnerability_results</span><span class="p">[</span><span class="s1">&#39;vuln_corrected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vulnerability_results</span><span class="p">[</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">vulnerability_results</span><span class="p">[</span><span class="s1">&#39;liquefaction_corr&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>liquefaction correction boolean: 100%|█████████████████████████████████████████| 84838/84838 [00:09&lt;00:00, 9388.17it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="performing-the-damage-assessment">
<h2>6. Performing the Damage Assessment<a class="headerlink" href="#performing-the-damage-assessment" title="Permalink to this heading">#</a></h2>
<p>In case we do have cost values, we can fully assess the damages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">damage_results</span> <span class="o">=</span> <span class="n">DamageScanner</span><span class="p">(</span><span class="n">hazard_country</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">damage_curves</span><span class="p">,</span> <span class="n">maxdam</span><span class="p">)</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overlay raster with vector: 100%|████████████████████████████████████████████████████| 144/144 [04:05&lt;00:00,  1.70s/it]
convert coverage to meters: 100%|██████████████████████████████████████████████| 84838/84838 [00:29&lt;00:00, 2893.04it/s]
Calculating damage: 100%|█████████████████████████████████████████████████████| 84838/84838 [00:06&lt;00:00, 13959.52it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: total: 3min 53s
Wall time: 4min 46s
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>And again, we correct for the liquefaction</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tqdm</span><span class="o">.</span><span class="n">pandas</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s1">&#39;liquefaction correction boolean&#39;</span><span class="p">)</span>
<span class="n">damage_results</span><span class="p">[</span><span class="s1">&#39;liquefaction_corr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">damage_results</span><span class="o">.</span><span class="n">progress_apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">feature</span><span class="p">:</span> <span class="n">get_damage_bool</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span><span class="n">liquefaction_results</span><span class="p">,</span><span class="n">damage_dict</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">damage_results</span><span class="p">[</span><span class="s1">&#39;damage_corrected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">damage_results</span><span class="p">[</span><span class="s1">&#39;damage&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">damage_results</span><span class="p">[</span><span class="s1">&#39;liquefaction_corr&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>liquefaction correction boolean: 100%|█████████████████████████████████████████| 84838/84838 [00:09&lt;00:00, 8559.39it/s]
</pre></div>
</div>
</div>
</div>
</section>
<section id="save-the-results">
<h2>7. Save the Results<a class="headerlink" href="#save-the-results" title="Permalink to this heading">#</a></h2>
<p>For further analysis, we can save the results in their full detail, or save summary estimates per subnational unit. We show how to do this using the damage results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard</span> <span class="o">=</span> <span class="s1">&#39;earthquake&#39;</span>
<span class="n">return_period</span> <span class="o">=</span> <span class="s1">&#39;1_475&#39;</span>
<span class="n">damage_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Road_Damage_</span><span class="si">{</span><span class="n">country_full_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">hazard</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">return_period</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">admin1_country</span> <span class="o">=</span> <span class="n">admin1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">admin1</span><span class="o">.</span><span class="n">sov_a3</span> <span class="o">==</span> <span class="n">country_iso3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">damage_results</span> <span class="o">=</span> <span class="n">damage_results</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">admin1_country</span><span class="p">[[</span><span class="s1">&#39;adm1_code&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">admin1_damage</span> <span class="o">=</span> <span class="n">admin1_country</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">damage_results</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;damage&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                                     <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                     <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                                     <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;adm1_code&#39;</span><span class="p">,</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span><span class="s1">&#39;damage&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">admin1_damage</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Admin1_Road_Damage_</span><span class="si">{</span><span class="n">country_full_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">hazard</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">return_period</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-the-results">
<h2>8. Visualizing the Results<a class="headerlink" href="#visualizing-the-results" title="Permalink to this heading">#</a></h2>
<p>The results of the damage assessment can be visualized using charts and maps. This will provide a clear representation of which infrastructure is most affected by the hazard and the expected damage levels.</p>
<p>Find the locations of the twenty most damaged roads.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">damage_results</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;damage_corrected&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;Red&#39;</span><span class="p">)</span>
<span class="n">features</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">world_plot</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">world</span><span class="o">.</span><span class="n">SOV_A3</span> <span class="o">==</span> <span class="n">country_iso3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">cx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/527139547e2d99b84c2d992feba6c74113a39b743620f3a56a457299457cb407.png" src="../_images/527139547e2d99b84c2d992feba6c74113a39b743620f3a56a457299457cb407.png" />
</div>
</div>
<p>And create a distribution of the damages.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">damage_results</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;damage&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;damage&#39;, ylabel=&#39;Count&#39;&gt;
</pre></div>
</div>
<img alt="../_images/12ffb0251cd24bbfbc49242805f66af7f190e4fae50a026326af863e5aafa2d1.png" src="../_images/12ffb0251cd24bbfbc49242805f66af7f190e4fae50a026326af863e5aafa2d1.png" />
</div>
</div>
<p>Plot all damages</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">damage_results</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;damage_corrected&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">legend_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;shrink&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;Absolute Damage&#39;</span><span class="p">},</span><span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">features</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">3857</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">world_plot</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">world</span><span class="o">.</span><span class="n">SOV_A3</span> <span class="o">==</span> <span class="n">country_iso3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">cx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">CartoDB</span><span class="o">.</span><span class="n">Positron</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9aba55f61756212583b6529ecdb6579f88b0e2d0036a0f41a6385206fea75969.png" src="../_images/9aba55f61756212583b6529ecdb6579f88b0e2d0036a0f41a6385206fea75969.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./hazard"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="flood.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Flood risk assessment</p>
      </div>
    </a>
    <a class="right-next"
       href="wildfire.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Wildfire exposure assessment</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-necessary-packages">1. Loading the Necessary Packages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-the-country-of-interest">Specify the country of interest</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-data">2. Loading the Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#infrastructure-data">Infrastructure Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hazard-data">Hazard Data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-damages">Maximum damages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#vulnerability-data">Vulnerability data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ancilliary-data-for-processing">Ancilliary data for processing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-data">3. Preparing the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-an-exposure-assessment">4. Performing an Exposure Assessment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-a-vulnerability-assessment">5. Performing a Vulnerability Assessment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performing-the-damage-assessment">6. Performing the Damage Assessment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-the-results">7. Save the Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-results">8. Visualizing the Results</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Institute for Environmental Studies, Vrije Universiteit Amsterdam
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>